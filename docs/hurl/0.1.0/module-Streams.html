<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      Streams - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      HURL Documentation
    </h3>

    
      <h3>
        Resources
      </h3>
      
        <a href="http://thi.ng/umbrella">@thi.ng/umbrella</a>
      
    

    <h3>Modules</h3><ul><li id="Streams-nav"><a href="module-Streams.html">Streams</a></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#prefetch_link">prefetch_link</a></li><li><a href="global.html#hurl_dispatch">hurl_dispatch</a></li><li><a href="global.html#hurl_router">hurl_router</a></li><li><a href="global.html#register_router_BOM">register_router_BOM</a></li><li><a href="global.html#parse_href">parse_href</a></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        Streams
      </h1>
    

    

<section>
  <header>
    
      
  </header>

  <article>
    <div class="container-overview">
      
        

        
      
    </div>

    

    

    

     

    

    
        <h3 class="subsection-title">Members</h3>

        
            

<h4 class="name" id=".run$">
  <span class="type-signature">(static, constant) </span>run$<span class="type-signature"></span>
</h4>




  <div class="description">
    <h1>Stream Architecture:</h1>
<p><code>run$</code> is the primary event stream exposed to the user
via the <code>ctx</code> object injected into every <code>hdom</code> component
the command stream is the only way the user changes
anything in <code>hurl</code></p>
<h2>Marble Diagram</h2>
<pre class="prettyprint source"><code>0>- |------c---------c--[ a, b, a ]-a----c-> : run$
1>- |ps|---1---------1------------0-1----1-> : pubsub
3>- ---|tp|------*-*-*----------*---*----*-> : command$
2>- ---|tp|xf|---^-^------------^-?--------> : task$
4>- ------|ps|--|a-b-c----------a---a----c-> : pubsub
Handlers
a>- ---------|tp|*--------------*---*------>
b>- ---------|tp|--*----------------------->
c>- ---------|tp|----*-------------------*->
</code></pre>
<h2>Streams</h2>
<ul>
<li><code>0&gt;-</code>: <code>ctx.run$.next(x)</code> userland dispatch stream</li>
<li><code>1&gt;-</code>: <code>pubsub({ topic: x =&gt; x.length === 0 })</code></li>
<li><code>2&gt;-</code>: pubsub = <code>false</code> ? -&gt; <code>task$</code>: Task Dispatcher</li>
<li><code>3&gt;-</code>: pubsub = <code>true</code> ? -&gt; <code>command$</code>: Commands stream</li>
<li><code>4&gt;-</code>: <code>pubsub({ topic: x =&gt; x.sub$ })</code>: userland handlers</li>
</ul>
<h2>Handlers</h2>
<p><code>4&gt;-</code> this is the stream to which the user (and framework)
attaches handlers. Handlers receive events they subscribe
to as topics based on a <code>sub$</code> key in a Command object.</p>
<h3>Handlers (framework provided):</h3>
<ul>
<li>&quot;state&quot;: Global state mutations</li>
<li>&quot;route&quot;: Routing</li>
<li>&quot;FLIP&quot; : <a href="https://aerotwist.com/blog/flip-your-animations/">F.L.I.P.</a> animations</li>
</ul>
<p>ðŸ“Œ TODO:</p>
<ul>
<li>add <strong>Examples</strong></li>
<li>add <code>beforeunload</code> event handler within #4 (orphan):
SEE https://youtu.be/QQukWZcIptM</li>
<li>enable ctx.run.cancel() via external or internal events
(e.g., popstate / { sub$:  &quot;cancel&quot; })</li>
</ul>
<h2><code>run$</code></h2>
<p>User-land event dispatch stream</p>
<p>This stream is directly exposed to users via <code>ctx</code>
Any one-off Commands <code>next</code>ed into this stream are sent
to the <code>command$</code> stream. Arrays of Commands (Tasks) are
sent to the <code>task$</code> stream.</p>
  </div>




<dl class="details">

  

  

  

  

  

  

  

  

  

  

  

  

  
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source">
      <ul class="dummy">
        <li>
          <a href="dispatchers_streams.js.html">dispatchers/streams.js</a>, <a href="dispatchers_streams.js.html#line93">line 93</a>
        </li>
      </ul>
    </dd>
  

  

  

  
</dl>






          
        
            

<h4 class="name" id=".command$">
  <span class="type-signature">(static, constant) </span>command$<span class="type-signature"></span>
</h4>




  <div class="description">
    <h2><code>command$</code></h2>
<p>Primary read stream
All user-defined handlers are attached to a <code>pubsub</code>
stemming from this stream. The <code>topic</code> function used
to alert downstream handlers is a simple lookup of the
<code>sub$</code> key of the command</p>
  </div>




<dl class="details">

  

  

  

  

  

  

  

  

  

  

  

  

  
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source">
      <ul class="dummy">
        <li>
          <a href="dispatchers_streams.js.html">dispatchers/streams.js</a>, <a href="dispatchers_streams.js.html#line105">line 105</a>
        </li>
      </ul>
    </dd>
  

  

  

  
</dl>






          
        
            

<h4 class="name" id=".task$">
  <span class="type-signature">(static, constant) </span>task$<span class="type-signature"></span>
</h4>




  <div class="description">
    <h2><code>task$</code></h2>
<p>Batch processing stream, listens for Tasks sent as an
array of Commands (including subtask functions)</p>
<p>stream (if array of event objects)</p>
  </div>




<dl class="details">

  

  

  

  

  

  

  

  

  

  

  

  

  
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source">
      <ul class="dummy">
        <li>
          <a href="dispatchers_streams.js.html">dispatchers/streams.js</a>, <a href="dispatchers_streams.js.html#line116">line 116</a>
        </li>
      </ul>
    </dd>
  

  

  

  
</dl>






          
        
            

<h4 class="name" id=".trace_stream">
  <span class="type-signature">(static, constant) </span>trace_stream<span class="type-signature"></span>
</h4>




  <div class="description">
    <h3><code>trace_stream</code></h3>
<p>simple ad-hoc tracer to log one of the streams emmissions</p>
  </div>




<dl class="details">

  

  

  

  

  

  

  

  

  

  

  

  

  
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source">
      <ul class="dummy">
        <li>
          <a href="dispatchers_streams.js.html">dispatchers/streams.js</a>, <a href="dispatchers_streams.js.html#line128">line 128</a>
        </li>
      </ul>
    </dd>
  

  

  

  
</dl>






          
        
            

<h4 class="name" id=".dispatcher">
  <span class="type-signature">(static, constant) </span>dispatcher<span class="type-signature"></span>
</h4>




  <div class="description">
    <h3><code>dispatcher</code></h3>
<p>Async <code>reduce</code> function, that passes an <em>object</em> as a state
container between Command invocations.</p>
<h3>TL;DR:</h3>
<p>Handles any state updates and/or other effects which
require <em>ordered</em> choreography and/or have a dependency
on some (a/sync) data produced by a user interaction.</p>
<h3>Synopsis:</h3>
<ul>
<li>very simple async finite state machine.</li>
<li>Commands are composed in-situ in userland (Ad hoc)</li>
<li>spools a collection of Commands as a Task</li>
<li>resolves any promises contained within a Command</li>
<li>passes an accumulator (STATE) to subsequent Commands in
a Task</li>
</ul>
<h3>Type checks on function signatures</h3>
<p>There are two valid forms for Task entries:</p>
<ol>
<li>a Unary function: alias/refer to sub Tasks</li>
<li>A Command object: dispatch to Command stream</li>
</ol>
<h2>Recognized Keys</h2>
<p>There are 5 recognized keys for a Command object:</p>
<blockquote>
<p>Required keys</p>
</blockquote>
<ol>
<li><code>sub$</code> key = primary identifier</li>
</ol>
<ul>
<li>used for registering handlers hooked onto the Command stream.</li>
</ul>
<ol start="2">
<li><code>args</code> key = <strong>primary control structure</strong></li>
</ol>
<ul>
<li>non-function vals send the Command as-is</li>
<li><code>(0)=&gt;</code> nullary fns send the <em>args</em> as a Command to
the <code>sub$</code> stream of your choosing (see Ad-hoc Stream
Injection below)</li>
<li><code>(1)=&gt;</code> unary fns are passed the STATE and called</li>
<li>Promises (and those returned from <code>(1)=&gt;</code>) are resolved</li>
<li>new vals are merged with STATE (dupe keys overwritten)</li>
</ul>
<blockquote>
<p>Promise-specific keys -&gt; binary (as in two parameter,
not boolean) functions:</p>
</blockquote>
<ol start="3">
<li>
<p><code>reso</code> key = handle resolved promises: <code>(2)=&gt;</code> MUST be
a binary fn <code>(STATE, resolved Promise) =&gt;</code></p>
</li>
<li>
<p><code>erro</code> key = handle rejected promises : <code>(2)=&gt;</code> MUST be
a binary fn <code>(STATE, Promise rejection) =&gt;</code></p>
</li>
</ol>
<blockquote>
<p>State-specific key:</p>
</blockquote>
<ol start="5">
<li><code>path</code> key = lens</li>
</ol>
<ul>
<li>this is used to cursor into the global state
<a href="http://thi.ng/atom">Atom</a> for global state evolution
(immutably of course)</li>
<li>you can do anything you want with it. It's allowed to
be any form of static data (no functions), but its
presence sets dispatcher to trigger a Command.</li>
</ul>
<h3>Examples: ðŸ“Œ TODO</h3>
<h2>Subtasks:</h2>
<p>Subtasks are the way you compose tasks. Insert a Task and
the dispatcher will unpack it in place
(super -&gt; sub order preserved)
A Subtask must be defined as a unary function that
accepts a state object and returns a Task, e.g.:</p>
<pre class="prettyprint source lang-js"><code>// pseudo:
let someSubtask = state => [{C}, {C}, (S)=>[...], ...]
// { C: Command }
// ( S: STATE ) => [...]: Subtask

// example:
let subtask1 = state => [
 { sub$: &quot;state&quot;
 , path: [&quot;body&quot;]
 , args: { data: state.data } },
 { sub$: &quot;route&quot;
 , args: { route: { href: state.href } } }
]

let task = [
 { sub$: &quot;init&quot;, args: { href: &quot;https://my.io/todos&quot; } },
 { sub$: &quot;fetch&quot;
 , args: ({href}) => fetch(href).then(r => r.json())
 , erro: (state, err) => ({ sub$: &quot;cancel&quot;, args: err })
 , reso: (state, res) => ({ data: res }) },
 state => subtask1(state), // subtask reference
 { sub$: &quot;FLIP&quot;, args: &quot;done&quot; }
]
</code></pre>
<h2>Ad-hoc stream injection</h2>
<p>ADVANCED USE ONLY
HURL tries to hide the stream implentation from the user
as much as possible, but allows you to go further down
the rabbit hole if so desired. You may send Commands to a
separate stream of your own creation by using a unary
<code>(0)=&gt;</code> function signature as your <code>args</code> value
If this is the case, the dispatcher assumes the
<code>sub$</code> key references a stream and sends the return value
of the thunk to that stream</p>
<blockquote>
<p>Note: if you need to pass in state/data to your thunk,
put it in a subtask, where you can access/destructure the
data from the state passed into the subtask function</p>
</blockquote>
<pre class="prettyprint source lang-js"><code>import { stream, trace } from &quot;@thi.ng/rstream&quot;

let login = stream().subscribe(trace(&quot;login ->&quot;))

let subtask_login = state => [
 { sub$: login // &lt;- ad hoc stream
 , args: { data: state.token } } // &lt;- you can use state
]

let task = [
 { sub$: login, args: () => &quot;logging in...&quot; }
 { sub$: &quot;init&quot;, args: { href: &quot;https://my.io/auth&quot; } },
 { sub$: &quot;cookie&quot;
 , args: ({href}) => fetch(href).then(r => r.json())
 , erro: (state, err) => ({ sub$: &quot;cancel&quot;, args: err })
 , reso: (state, res) => ({ token: res }) },
 state => subtask_login(state),
 { sub$: login, args: () => &quot;log in success&quot; }
]
</code></pre>
<h2>Caveats:</h2>
  </div>




<dl class="details">

  

  

  

  

  

  

  

  

  

  

  

  

  
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source">
      <ul class="dummy">
        <li>
          <a href="dispatchers_streams.js.html">dispatchers/streams.js</a>, <a href="dispatchers_streams.js.html#line300">line 300</a>
        </li>
      </ul>
    </dd>
  

  

  

  
</dl>






          
        
    

    

    

    
  </article>
</section>




  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>