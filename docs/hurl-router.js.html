<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: hurl-router.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: hurl-router.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { stream } from "@thi.ng/rstream"
import { parse_href } from "./"
import { trigger_async_route } from "./hurl"
import { map } from "@thi.ng/transducers"
// import { log } from "./utils"
// import fetch from "node-fetch"

//
//  888                               _-~88e
//  888-~88e  e88~-_  Y88b    e    / /   88"
//  888  888 d888   i  Y88b  d8b  /  `   8P
//  888  888 8888   |   Y888/Y88b/       `
//  888  888 Y888   '    Y8/  Y8/      d88b
//  888  888  "88_-~      Y    Y       Y88P
//
//  do I generalize this if at all...

/**
 * raw data stream
 * you can subscribe to this and handle/inject events directly
 * the `hurl_data` prop should be destructured/plucked for data handling
 * see http://thi.ng/rstream for `stream` docs
 * */
export const hurl_data_stream = stream()
/**
 * preconfigured dispatch from hurl_data_stream
 * this is an event handler that subscribes to the
 * `hurl_data_stream` internally and applies a user-defined callback `fn`
 * to every emission of data from the stream
 * */
export const hurl_dispatch = fn => hurl_data_stream.subscribe(map(x => fn(x)))

/**
 * Takes a routing configuration function and returns a router that
 * recieves a stream of incomming URLs/ and applies the configuration
 * to each one. Once the data is resolved for the URL, dispatches to a
 * completion stream to actually triggers a change in the browser router
 * @requires http://thi.ng/EquivMap
 *
 * ```js
 * const getSomeJSON = async (query, path, b) => {
 *   const base = "https://jsonplaceholder.typicode.com/"
 *   const data = b
 *     ? await fetch(`${base}${path}/${b}`).then(r => r.json())
 *     : await fetch(`${base}${path}/`).then(r => r.json())
 *   return data
 * }
 * const routes = async state => {
 *   let {
 *     subdomain,       // array
 *     domain,           // array
 *     path: [p_a, p_b], // array
 *     query,            // object
 *     hash              // string
 *   } = state
 *
 *   return await new EquivMap([
 *     [{ ...state, path: ["todos"] },      getSomeJSON(query, "todos")],
 *     [{ ...state, path: ["todos", p_b] }, getSomeJSON(query, "todos", p_b)],
 *     [{ ...state, path: ["users"] },      getSomeJSON(query, "users")],
 *     [{ ...state, path: ["users", p_b] }, getSomeJSON(query, "users", p_b)]
 *   ]).get(state)) || null
 * }
 * export const router = hurl_router(routes)
 * ```
 * */
export const hurl_router = config_fn => async h => {
  const state = parse_href(h)
  // log("state:", state)
  let data = await config_fn(state)
  hurl_data_stream.next({ hurl_data: data, hurl_state: state })
  trigger_async_route(true)
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#command$">command$</a></li><li><a href="global.html#dispatcher">dispatcher</a></li><li><a href="global.html#hurl_dispatch">hurl_dispatch</a></li><li><a href="global.html#hurl_router">hurl_router</a></li><li><a href="global.html#parse_href">parse_href</a></li><li><a href="global.html#prefetch_link">prefetch_link</a></li><li><a href="global.html#register_router_BOM">register_router_BOM</a></li><li><a href="global.html#run$">run$</a></li><li><a href="global.html#task$">task$</a></li><li><a href="global.html#trace_stream">trace_stream</a></li><li><a href="global.html#unknown_key">unknown_key</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sat Dec 21 2019 19:26:17 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
