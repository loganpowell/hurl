<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: hurl.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: hurl.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {
  fromDOMEvent,
  merge,
  sidechainPartition,
  stream
} from "@thi.ng/rstream"
import * as xf from "@thi.ng/transducers"
import { parse_href } from "./"
import { hurl_dispatch } from "./hurl-router"
import { log, start, end } from "./utils"

// ðŸ“Œ TODO: change to a component

const popstate_stream_BOM = fromDOMEvent(window, "popstate", "popstate-stream")
const load_stream_BOM = fromDOMEvent(window, "DOMContentLoaded", "load-stream")
const async_route = stream()
const nav_stream_BOM = merge({ src: [popstate_stream_BOM, load_stream_BOM] })

export const async_nav_stream_BOM = nav_stream_BOM.subscribe(
  sidechainPartition(async_route)
)

/**
 * represents the actual routing event stream that triggers:
 * A: history.pushState event (changes browser URL)
 * B: dispatches custom 'page-ready' event used for prerender
 * */
async_nav_stream_BOM.subscribe(
  xf.map(x => {
    history.pushState(
      parse_href(x[0].target.location.href),
      null,
      x[0].target.location.href
    )
    document.dispatchEvent(new Event("page-ready"))
  })
)

// link clicking
export const hurl_link = e => {
  e.preventDefault()
  log(e.target.href)
  if (window.location.href === e.target.href) return

  popstate_stream_BOM.next({
    target: {
      location: e.target
    }
  })
  return e
  // history.pushState(parse_hurl(e.target.href), null, e.target.href)
}

//https://stackoverflow.com/questions/3163615/how-to-scroll-html-page-to-given-anchor
export const hash_handler = hash => (location.hash = "#" + hash)

// or
// someDOMNode.scrollIntoView();
export const trigger_async_route = arg => async_route.next(arg)
/**
 * takes a `hurl_router` (configured routing fn) and applies the router on
 * every emission of the browser navigation stream (a stream of nav events)
 * the returned dispatching function allows the user to hook into the data
 * emitted as per her router configuration and deploy some function thereupon
 * @returns hurl_dispatch - an event listener for dispatching
 * */
export const register_router_BOM = hurl_router => {
  nav_stream_BOM.subscribe(
    // trace("route"),
    xf.map(
      x => (
        start("dispatch"), hurl_router(x.target.location.href), end("dispatch")
      )
    )
  )
  return hurl_dispatch
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#command$">command$</a></li><li><a href="global.html#dispatcher">dispatcher</a></li><li><a href="global.html#hurl_dispatch">hurl_dispatch</a></li><li><a href="global.html#hurl_router">hurl_router</a></li><li><a href="global.html#parse_href">parse_href</a></li><li><a href="global.html#prefetch_link">prefetch_link</a></li><li><a href="global.html#register_router_BOM">register_router_BOM</a></li><li><a href="global.html#run$">run$</a></li><li><a href="global.html#task$">task$</a></li><li><a href="global.html#trace_stream">trace_stream</a></li><li><a href="global.html#unknown_key">unknown_key</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sat Dec 21 2019 19:26:17 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
